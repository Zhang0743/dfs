syntax = "proto3";
package dfs;
option go_package = "./;dfspb";
service Tracker {
    rpc RegisterNode(RegisterRequest) returns (RegisterResponse);
    rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
    rpc GetUploadNodes(GetUploadNodesRequest) returns (GetUploadNodesResponse);
}

message NodeInfo {
    string node_id = 1;
    string address = 2;
    string status = 3;
    int64 available_space = 4;
}

message RegisterRequest {
    string node_id = 1;
    string address = 2;
    int64 available_space = 3;
}

message RegisterResponse {
    bool success = 1;
    string message = 2;
}

message HeartbeatRequest {
    string node_id = 1;
    int64 available_space = 2;
    int32 chunk_count = 3;
}

message HeartbeatResponse {
    bool success = 1;
}

message GetUploadNodesRequest {
    string file_id = 1;
    int32 chunk_count = 2;
}

message GetUploadNodesResponse {
    repeated NodeInfo nodes = 1;
}

service Storage {
    rpc StoreChunk(stream ChunkData) returns (StoreResponse);
}

message ChunkData {
    string chunk_id = 1;
    bytes data = 2;
    int32 index = 3;
}

message StoreResponse {
    bool success = 1;
    string checksum = 2;
}
